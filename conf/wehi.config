process {
    withLabel:process_gpu {
        clusterOptions = "--gres gpu:1 --constraint Ampere" // use either A30s or A100s - P100s don't work with dorado
        queue = "gpuq"
        cpus = 24
        memory = "100GB"
    }
    withName:SAMTOOLS_MERGE {
        module = "samtools/1.19.2"
    }
    withName:SAMTOOLS_INDEX {
        module = "samtools/1.19.2"
    }
    withName:FILTER_PASS {
        module = "bcftools/1.17:htslib/1.17"
    }
    withName:MINIMAP2 {
        module = "minimap2/2.17:samtools/1.19.2"
    }
    withLabel:process_low {
        cpus   = { check_max( 4     * task.attempt, 'cpus'    ) }
        memory = { check_max( 12.GB * task.attempt, 'memory'  ) }
        time   = { check_max( 4.h   * task.attempt, 'time'    ) }
    }
    withLabel:process_medium {
        cpus   = { check_max( 12     * task.attempt, 'cpus'    ) }
        memory = { check_max( 36.GB * task.attempt, 'memory'  ) }
        time   = { check_max( 8.h   * task.attempt, 'time'    ) }
    }
    withLabel:process_high {
        cpus   = { check_max( 24    * task.attempt, 'cpus'    ) }
        memory = { check_max( 72.GB * task.attempt, 'memory'  ) }
        time   = { check_max( 16.h  * task.attempt, 'time'    ) }
    }
}
singularity.runOptions = "--nv -B /vast -B /stornext"
